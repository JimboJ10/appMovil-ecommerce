<ion-header class="ion-no-border">
  <ion-toolbar color="transparent">
    <ion-buttons slot="start">
      <ion-button (click)="volverLogin()">
        <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Recuperar Contraseña</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <div class="contenedor-recuperar">
    <!-- Email NO enviado -->
    <div *ngIf="!emailEnviado">
      <!-- Icono y descripción -->
      <div class="encabezado">
        <ion-icon name="lock-closed" class="icono-principal"></ion-icon>
        <h2 class="titulo">¿Olvidaste tu contraseña?</h2>
        <p class="descripcion">
          No te preocupes. Ingresa tu correo electrónico y te enviaremos las instrucciones para recuperar tu cuenta.
        </p>
      </div>

      <!-- Formulario -->
      <form [formGroup]="formularioRecuperar" (ngSubmit)="enviarInstrucciones()" class="formulario">
        <div class="campo-formulario">
          <ion-label position="stacked" class="etiqueta-campo">
            Correo Electrónico <span class="requerido">*</span>
          </ion-label>
          <ion-item 
            lines="none" 
            class="campo-input"
            [class.input-invalido]="emailInvalido">
            <ion-icon name="mail-outline" slot="start" class="icono-campo"></ion-icon>
            <ion-input
              type="email"
              formControlName="email"
              placeholder="correo@ejemplo.com"
              autocomplete="email"
              inputmode="email">
            </ion-input>
          </ion-item>
          <div class="mensaje-error" *ngIf="emailInvalido">
            <ion-icon name="alert-circle"></ion-icon>
            <span>{{ obtenerMensajeErrorEmail() }}</span>
          </div>
        </div>

        <ion-button 
          expand="block" 
          type="submit"
          class="boton-primario"
          [disabled]="cargando">
          <ion-spinner name="crescent" *ngIf="cargando"></ion-spinner>
          {{ cargando ? 'Enviando...' : 'Enviar Instrucciones' }}
        </ion-button>

        <div class="enlace-volver">
          <ion-text color="primary" (click)="volverLogin()">
            <ion-icon name="arrow-back-outline"></ion-icon>
            Volver al inicio de sesión
          </ion-text>
        </div>
      </form>
    </div>

    <!-- Email ENVIADO -->
    <div *ngIf="emailEnviado" class="contenedor-exito">
      <div class="icono-exito">
        <ion-icon name="checkmark-circle"></ion-icon>
      </div>
      <h2 class="titulo-exito">¡Correo Enviado!</h2>
      <p class="mensaje-exito">
        Hemos enviado las instrucciones de recuperación a tu correo electrónico.
        <br><br>
        Por favor revisa tu bandeja de entrada y sigue las indicaciones para restablecer tu contraseña.
      </p>

      <ion-button 
        expand="block" 
        class="boton-secundario"
        (click)="reenviarCorreo()">
        <ion-icon name="mail-outline" slot="start"></ion-icon>
        Reenviar Correo
      </ion-button>

      <ion-button 
        expand="block" 
        fill="clear"
        class="boton-volver"
        (click)="volverLogin()">
        Volver al Inicio
      </ion-button>
    </div>
  </div>
</ion-content>